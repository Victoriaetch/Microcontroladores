#include <Arduino.h>

// Pines de columnas C1–C8 → D2–D9
const uint8_t columnas[8] = {2,3,4,5,6,7,8,9};

// Pines de filas F1–F8 → D10–D13, A0–A3
const uint8_t filas[8] = {10,11,12,13,A0,A1,A2,A3};

// Botones
#define BOTON_SIGUIENTE 2
#define BOTON_MAS_RAPIDO 3
#define BOTON_MAS_LENTO 4

uint16_t tiempo_retardo = 200; // ms

// Letras 8x8 (mensaje "HOLA MUNDO")
uint8_t letras[][8] = {
    {0x7E,0x09,0x09,0x09,0x7E,0x00,0x00,0x00}, // H
    {0x7F,0x49,0x49,0x49,0x41,0x00,0x00,0x00}, // O
    {0x7F,0x08,0x08,0x08,0x7F,0x00,0x00,0x00}, // L
    {0x7F,0x08,0x08,0x08,0x7F,0x00,0x00,0x00}, // A
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}, // espacio
    {0x7E,0x09,0x09,0x09,0x7E,0x00,0x00,0x00}, // M
    {0x7F,0x49,0x49,0x49,0x41,0x00,0x00,0x00}, // U
    {0x7F,0x09,0x09,0x09,0x7F,0x00,0x00,0x00}, // N
    {0x3E,0x41,0x41,0x41,0x3E,0x00,0x00,0x00}, // D
    {0x7F,0x01,0x01,0x01,0x7F,0x00,0x00,0x00}  // O
};

// Retardo variable
void retardo_ms(uint16_t ms){
  for(uint16_t i=0;i<ms;i++) delayMicroseconds(1000);
}

// Muestra una letra en la matriz
void mostrar_letra(uint8_t indice){
  for(uint8_t fila=0; fila<8; fila++){
    // Apagar todas las filas
    for(uint8_t r=0;r<8;r++) digitalWrite(filas[r], LOW);

    // Activar fila actual
    digitalWrite(filas[fila], HIGH);

    // Encender columnas según bits
    for(uint8_t col=0; col<8; col++){
      if(letras[indice][fila] & (1<<col)) digitalWrite(columnas[col], LOW); // Común ánodo
      else digitalWrite(columnas[col], HIGH);
    }
    retardo_ms(tiempo_retardo/4);
  }
}

void setup(){
  // Configurar filas y columnas como salida
  for(uint8_t i=0;i<8;i++){
    pinMode(filas[i], OUTPUT);
    pinMode(columnas[i], OUTPUT);
    digitalWrite(filas[i], LOW);
    digitalWrite(columnas[i], HIGH);
  }

  // Botones como entrada con pull-up
  pinMode(BOTON_SIGUIENTE, INPUT_PULLUP);
  pinMode(BOTON_MAS_RAPIDO, INPUT_PULLUP);
  pinMode(BOTON_MAS_LENTO, INPUT_PULLUP);
}

void loop(){
  static uint8_t indice_letra = 0;
  uint8_t largo_mensaje = sizeof(letras)/sizeof(letras[0]);

  if(digitalRead(BOTON_SIGUIENTE) == LOW){
    mostrar_letra(indice_letra);
    indice_letra++;
    if(indice_letra >= largo_mensaje) indice_letra=0;
    delay(200); // antirrebote
  }

  if(digitalRead(BOTON_MAS_RAPIDO) == LOW){
    if(tiempo_retardo>50) tiempo_retardo -= 50;
    delay(50);
  }

  if(digitalRead(BOTON_MAS_LENTO) == LOW){
    if(tiempo_retardo<2000) tiempo_retardo += 50;
    delay(50);
  }
}

